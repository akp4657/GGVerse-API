generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Challenges {
  id                                   Int      @id @default(autoincrement())
  ChallengerId                         Int
  ChallengedId                         Int
  Game                                 String   @db.VarChar
  Wager                                Decimal  @db.Decimal
  Status                               String   @default("pending") @db.VarChar
  CreatedAt                            DateTime @default(now()) @db.Timestamptz(6)
  ExpiresAt                            DateTime @db.Timestamptz(6)
  DiscordThreadId                      String?  @db.VarChar
  DiscordThreadUrl                     String?  @db.VarChar
  Users_Challenges_ChallengedIdToUsers Users    @relation("Challenges_ChallengedIdToUsers", fields: [ChallengedId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Challenges_challengedId_fkey")
  Users_Challenges_ChallengerIdToUsers Users    @relation("Challenges_ChallengerIdToUsers", fields: [ChallengerId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Challenges_challengerId_fkey")

  @@index([ChallengedId], map: "Challenges_challengedId_idx")
  @@index([ChallengerId], map: "Challenges_challengerId_idx")
  @@index([CreatedAt], map: "Challenges_createdAt_idx")
  @@index([Status], map: "Challenges_status_idx")
}

model Discord_Threads {
  id         Int      @id(map: "Discord_Threads_pkey1") @default(autoincrement())
  ThreadId   String   @db.VarChar
  Members    Int[]
  Open       Boolean  @default(true)
  Dispute    Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model Lookup_Badge {
  id          Int     @id @default(autoincrement())
  Name        String? @db.VarChar
  Description String? @db.VarChar
  Icon        String? @db.VarChar
  Color       String? @db.VarChar
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Lookup_Console {
  id         Int      @id @default(autoincrement())
  Console    String?  @db.VarChar
  created_at DateTime @default(now()) @db.Timestamptz(6)
  Users      Users[]
}

model Lookup_Game {
  id            Int             @id(map: "Lookup_Games_pkey") @default(autoincrement())
  Game          String?
  API           String?         @db.VarChar
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  Match_History Match_History[]
}

model Lookup_PaymentType {
  id         Int      @id @default(autoincrement())
  Type       String?
  created_at DateTime @default(now()) @db.Timestamptz(6)
  Users      Users[]
}

model Lookup_Status {
  id            Int             @id @default(autoincrement())
  Status        String?
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  Match_History Match_History[]
}

model Match_History {
  id                            Int            @id(map: "Discord_Threads_pkey") @default(autoincrement())
  Game                          Int?
  P1                            Int?
  P2                            Int?
  Status                        Int?
  Result                        Boolean?
  created_at                    DateTime       @default(now()) @db.Timestamptz(6)
  PointDiff                     Int?
  RivalryHeat                   Float?         @default(0)
  BetAmount                     Decimal?       @db.Decimal
  Lookup_Game                   Lookup_Game?   @relation(fields: [Game], references: [id], onDelete: Cascade)
  Users_Match_History_P1ToUsers Users?         @relation("Match_History_P1ToUsers", fields: [P1], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Users_Match_History_P2ToUsers Users?         @relation("Match_History_P2ToUsers", fields: [P2], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Lookup_Status                 Lookup_Status? @relation(fields: [Status], references: [id], onDelete: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model PaymentMethod {
  id                      Int           @id @default(autoincrement())
  UserId                  Int
  Provider                String?       @default("paynetworx")
  ProviderPaymentMethodId String?       @db.VarChar
  CardLast4               String?       @db.VarChar
  CardBrand               String?       @db.VarChar
  CardExpMonth            String?       @db.VarChar
  CardExpYear             String?       @db.VarChar
  Active                  Boolean?
  Verified                Boolean?      @default(false)
  created_at              DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at              DateTime?     @db.Timestamptz(6)
  Users                   Users         @relation(fields: [UserId], references: [id], onDelete: Cascade)
  Transaction             Transaction[]
}

model Transaction {
  id                  Int            @id @default(autoincrement())
  UserId              Int
  Type                String         @db.VarChar
  Amount              Decimal        @db.Decimal
  Currency            String         @default("USD") @db.VarChar
  Description         String?        @db.VarChar
  PaynetworxPaymentId String?        @db.VarChar
  Paynetworx3DSId     String?        @db.VarChar
  Status              String         @default("completed") @db.VarChar
  created_at          DateTime       @default(now()) @db.Timestamptz(6)
  PaymentMethodId     Int?
  PaymentMethod       PaymentMethod? @relation(fields: [PaymentMethodId], references: [id], onDelete: Cascade)
  Users               Users          @relation(fields: [UserId], references: [id], onDelete: Cascade)
}

model Users {
  id                                        Int                @id(map: "Test-User-Table_pkey") @default(autoincrement())
  Username                                  String?
  Rank                                      Int?
  Wallet                                    Int                @default(0)
  PaymentType                               Int                @default(1)
  Rivals                                    Int[]
  Badges                                    Int[]
  Discord                                   String?            @db.VarChar
  Avatar                                    String?            @db.VarChar
  Authenticated                             Boolean            @default(false)
  Password                                  String?            @db.VarChar
  Email                                     String?            @unique @db.VarChar
  WinsLosses                                Json?              @db.Json
  Streak                                    Int?               @default(0)
  Earnings                                  Int?
  JWT                                       String?            @db.VarChar
  Active                                    Boolean?           @default(true)
  MMI                                       Json?              @default("{\"1\": 1000, \"2\": 1000, \"3\": 1000}") @db.Json
  LastMMIUpdate                             DateTime?
  Online                                    Boolean?           @default(false)
  Gamertag                                  String?            @db.VarChar
  Games                                     Int[]
  Console                                   Int?               @default(1)
  PushToken                                 String?
  Challenges_Challenges_ChallengedIdToUsers Challenges[]       @relation("Challenges_ChallengedIdToUsers")
  Challenges_Challenges_ChallengerIdToUsers Challenges[]       @relation("Challenges_ChallengerIdToUsers")
  Match_History_Match_History_P1ToUsers     Match_History[]    @relation("Match_History_P1ToUsers")
  Match_History_Match_History_P2ToUsers     Match_History[]    @relation("Match_History_P2ToUsers")
  PaymentMethod                             PaymentMethod[]
  Transaction                               Transaction[]
  Lookup_Console                            Lookup_Console?    @relation(fields: [Console], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Lookup_PaymentType                        Lookup_PaymentType @relation(fields: [PaymentType], references: [id], onDelete: SetDefault)
}
